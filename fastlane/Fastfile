# Fastfile for Watch the Corners. This will speed up deployment of the game.
fastlane_version '0.3.0'

before_all do
  ensure_git_status_clean

  ENV['SLACK_URL'] = 'https://hooks.slack.com/services/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'

  increment_build_number

  xcclean

  xctool :archive

  xcexport

end

lane :test do
  xctool :test
  snapshot
end

lane :beta do
  snapshot
  sigh
  deliver :skip_deploy, :beta
end

lane :deploy do
  snapshot
  sigh
  deliver :skip_deploy, :force
  frameit
end

after_all do |lane|
  clean_build_artifacts
  slack({
    message: "Successfully deployed an update for Watch The Corners via #{lane}",
    success: true
  })
  notify "Finished running #{lane}!"
end

error do |lane, exception|
  slack({
    message: "Error deploying your update for Watch the Corners via #{lane}, caused by #{exception}",
    success: false
    })
  notify "Error running #{lane}, caused by #{exception}."
end
